<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How We Reduced Black Friday AWS Spend by 52% - Suheb Ghare</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <nav>
            <div class="logo">Suheb Ghare</div>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="index.html#blog-index">Blog Index</a>
                <a href="https://portfolio.suhebghare.tech" target="_blank">Portfolio</a>
            </div>
        </nav>
    </header>

    <main>
        <a href="index.html" class="back-link">‚Üê Back to Home</a>
        
        <article class="blog-content">
            <div class="blog-header">
                <h1>How We Reduced Black Friday AWS Spend by 52%</h1>
                <div class="blog-meta">Published on November 28, 2024 | 16 min read</div>
            </div>


            <div class="blog-stats">
                <div class="stat-item">
                    <span class="icon">üëÅÔ∏è</span>
                    <span class="count reads-count">850</span>
                    <span class="label">reads</span>
                </div>
                <div class="stat-item">
                    <span class="icon">üëç</span>
                    <span class="count likes-count">355</span>
                    <span class="label">likes</span>
                </div>
                <div class="stat-item">
                    <span class="icon">üëé</span>
                    <span class="count dislikes-count">26</span>
                    <span class="label">dislikes</span>
                </div>
            </div>

            <div class="blog-actions">
                <button class="like-btn" onclick="blogStats.like('black-friday-aws-cost-reduction')">üëç Like</button>
                <button class="dislike-btn" onclick="blogStats.dislike('black-friday-aws-cost-reduction')">üëé Dislike</button>
            </div>
            <h2>The Challenge</h2>
            <p>Last year's Black Friday cost us $127,000 in AWS spend for 5 days. This year, we handled 3x more traffic for $61,000. Here's exactly how we did it.</p>

            <div class="grid-2">
                <div class="metric-card">
                    <h4>2023 Black Friday</h4>
                    <div class="metric-value">$127K</div>
                    <p>5-day AWS spend</p>
                </div>
                <div class="metric-card">
                    <h4>2024 Black Friday</h4>
                    <div class="metric-value">$61K</div>
                    <p>52% cost reduction</p>
                </div>
            </div>

            <h2>Cost Breakdown: Before vs After</h2>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Service</th>
                        <th>2023 Cost</th>
                        <th>2024 Cost</th>
                        <th>Savings</th>
                        <th>Strategy</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>EC2/EKS Compute</td>
                        <td>$68,000</td>
                        <td>$28,000</td>
                        <td><span class="cost-badge low">-59%</span></td>
                        <td>Spot + Karpenter</td>
                    </tr>
                    <tr>
                        <td>RDS</td>
                        <td>$22,000</td>
                        <td>$12,000</td>
                        <td><span class="cost-badge low">-45%</span></td>
                        <td>Aurora Serverless v2</td>
                    </tr>
                    <tr>
                        <td>Data Transfer</td>
                        <td>$18,000</td>
                        <td>$8,000</td>
                        <td><span class="cost-badge low">-56%</span></td>
                        <td>CloudFront + Compression</td>
                    </tr>
                    <tr>
                        <td>ElastiCache</td>
                        <td>$12,000</td>
                        <td>$8,000</td>
                        <td><span class="cost-badge low">-33%</span></td>
                        <td>Right-sizing</td>
                    </tr>
                    <tr>
                        <td>NAT Gateway</td>
                        <td>$4,500</td>
                        <td>$2,800</td>
                        <td><span class="cost-badge low">-38%</span></td>
                        <td>VPC Endpoints</td>
                    </tr>
                    <tr>
                        <td>Other Services</td>
                        <td>$2,500</td>
                        <td>$2,200</td>
                        <td><span class="cost-badge medium">-12%</span></td>
                        <td>Various</td>
                    </tr>
                </tbody>
            </table>

            <h2>Strategy 1: Aggressive Spot Instance Usage</h2>

            <div style="text-align: center; margin: 2rem 0;">
                <img src="images/finops-2.png" alt="Spot Instance Cost Savings Strategy" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
            </div>

            <div class="info-box success">
                <strong>Result:</strong> Reduced compute costs from $68K to $28K (59% savings)
            </div>

            <h3>What We Changed</h3>

            <div class="grid-2">
                <div class="info-box warning">
                    <h4>2023 Setup</h4>
                    <ul>
                        <li>80% On-Demand instances</li>
                        <li>20% Spot instances</li>
                        <li>Manual node group management</li>
                        <li>Conservative scaling</li>
                    </ul>
                </div>
                <div class="info-box success">
                    <h4>2024 Setup</h4>
                    <ul>
                        <li>15% On-Demand (critical only)</li>
                        <li>85% Spot instances</li>
                        <li>Karpenter auto-provisioning</li>
                        <li>Aggressive scaling</li>
                    </ul>
                </div>
            </div>

            <h3>Karpenter Configuration for Black Friday</h3>

            <pre><code>apiVersion: karpenter.sh/v1alpha5
kind: Provisioner
metadata:
  name: black-friday-spot
spec:
  requirements:
    - key: karpenter.sh/capacity-type
      operator: In
      values: ["spot"]
    - key: kubernetes.io/arch
      operator: In
      values: ["amd64"]
    - key: karpenter.k8s.aws/instance-category
      operator: In
      values: ["c", "m", "r"]
    - key: karpenter.k8s.aws/instance-generation
      operator: Gt
      values: ["5"]
  
  limits:
    resources:
      cpu: 2000
      memory: 4000Gi
  
  providerRef:
    name: black-friday
  
  # Aggressive consolidation
  ttlSecondsAfterEmpty: 15
  consolidation:
    enabled: true
---
apiVersion: karpenter.k8s.aws/instance-category
kind: Provisioner
metadata:
  name: black-friday-ondemand
spec:
  requirements:
    - key: karpenter.sh/capacity-type
      operator: In
      values: ["on-demand"]
  
  limits:
    resources:
      cpu: 200
      memory: 400Gi
  
  # Only for critical workloads
  labels:
    workload-type: critical</code></pre>

            <h3>Spot Interruption Handling</h3>

            <pre><code># AWS Node Termination Handler
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: aws-node-termination-handler
  namespace: kube-system
spec:
  template:
    spec:
      containers:
      - name: aws-node-termination-handler
        image: public.ecr.aws/aws-ec2/aws-node-termination-handler:v1.19.0
        env:
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: ENABLE_SPOT_INTERRUPTION_DRAINING
          value: "true"
        - name: ENABLE_SCHEDULED_EVENT_DRAINING
          value: "true"</code></pre>

            <div class="metric-card">
                <h4>Spot Interruptions During Black Friday</h4>
                <div class="metric-value">23</div>
                <p>All handled gracefully with zero downtime</p>
            </div>

            <h2>Strategy 2: Aurora Serverless v2</h2>

            <div class="info-box success">
                <strong>Result:</strong> Reduced database costs from $22K to $12K (45% savings)
            </div>

            <h3>The Problem with Traditional RDS</h3>

            <div class="timeline">
                <div class="timeline-item">
                    <strong>Day -2:</strong> Scaled up to db.r6g.8xlarge ($3.20/hour)
                </div>
                <div class="timeline-item">
                    <strong>Black Friday:</strong> Running at 40% utilization (wasted $1,920/day)
                </div>
                <div class="timeline-item">
                    <strong>Day +2:</strong> Forgot to scale down for 3 days (wasted $5,760)
                </div>
            </div>

            <h3>Aurora Serverless v2 Configuration</h3>

            <pre><code>resource "aws_rds_cluster" "main" {
  cluster_identifier      = "prod-aurora-serverless"
  engine                  = "aurora-postgresql"
  engine_mode             = "provisioned"
  engine_version          = "14.6"
  database_name           = "production"
  master_username         = "admin"
  
  serverlessv2_scaling_configuration {
    max_capacity = 128  # Scale up to 128 ACUs during peak
    min_capacity = 2    # Scale down to 2 ACUs during off-peak
  }
}

resource "aws_rds_cluster_instance" "main" {
  cluster_identifier = aws_rds_cluster.main.id
  instance_class     = "db.serverless"
  engine             = aws_rds_cluster.main.engine
  engine_version     = aws_rds_cluster.main.engine_version
}</code></pre>

            <h3>Aurora Serverless Scaling During Black Friday</h3>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Time Period</th>
                        <th>ACUs Used</th>
                        <th>Equivalent Instance</th>
                        <th>Cost</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Pre-sale (12am-8am)</td>
                        <td>4-8</td>
                        <td>db.r6g.large</td>
                        <td>$0.50/hour</td>
                    </tr>
                    <tr>
                        <td>Peak (8am-11pm)</td>
                        <td>80-120</td>
                        <td>db.r6g.8xlarge</td>
                        <td>$3.00/hour</td>
                    </tr>
                    <tr>
                        <td>Post-sale (11pm-12am)</td>
                        <td>10-15</td>
                        <td>db.r6g.xlarge</td>
                        <td>$0.75/hour</td>
                    </tr>
                </tbody>
            </table>

            <h2>Strategy 3: CloudFront + Compression</h2>

            <div class="info-box success">
                <strong>Result:</strong> Reduced data transfer from $18K to $8K (56% savings)
            </div>

            <h3>What We Optimized</h3>

            <ul class="icon-list">
                <li>Enabled Brotli compression (30% better than gzip)</li>
                <li>Increased CloudFront cache TTL from 1 hour to 24 hours</li>
                <li>Moved static assets to S3 + CloudFront</li>
                <li>Implemented image optimization (WebP format)</li>
                <li>Added cache-control headers</li>
            </ul>

            <h3>CloudFront Configuration</h3>

            <pre><code>resource "aws_cloudfront_distribution" "main" {
  enabled             = true
  price_class         = "PriceClass_100"  # US, Canada, Europe only
  
  origin {
    domain_name = aws_s3_bucket.assets.bucket_regional_domain_name
    origin_id   = "S3-assets"
    
    s3_origin_config {
      origin_access_identity = aws_cloudfront_origin_access_identity.main.cloudfront_access_identity_path
    }
  }
  
  default_cache_behavior {
    allowed_methods  = ["GET", "HEAD", "OPTIONS"]
    cached_methods   = ["GET", "HEAD"]
    target_origin_id = "S3-assets"
    
    compress = true  # Enable compression
    
    forwarded_values {
      query_string = false
      headers      = ["Accept-Encoding"]
      
      cookies {
        forward = "none"
      }
    }
    
    viewer_protocol_policy = "redirect-to-https"
    min_ttl                = 0
    default_ttl            = 86400   # 24 hours
    max_ttl                = 604800  # 7 days
  }
}</code></pre>

            <h3>Cache Hit Rate Improvement</h3>

            <div class="grid-2">
                <div class="metric-card">
                    <h4>2023 Cache Hit Rate</h4>
                    <div class="metric-value">62%</div>
                    <p>38% requests hit origin</p>
                </div>
                <div class="metric-card">
                    <h4>2024 Cache Hit Rate</h4>
                    <div class="metric-value">94%</div>
                    <p>Only 6% hit origin</p>
                </div>
            </div>

            <h2>Strategy 4: ElastiCache Right-Sizing</h2>

            <div class="info-box success">
                <strong>Result:</strong> Reduced cache costs from $12K to $8K (33% savings)
            </div>

            <h3>The Over-Provisioning Problem</h3>

            <div class="info-box warning">
                <strong>2023:</strong> Running 6x cache.r6g.2xlarge nodes (52GB each) at 30% memory utilization
            </div>

            <h3>Right-Sizing Analysis</h3>

            <pre><code># Analyzed actual memory usage
aws cloudwatch get-metric-statistics \
  --namespace AWS/ElastiCache \
  --metric-name DatabaseMemoryUsagePercentage \
  --dimensions Name=CacheClusterId,Value=prod-redis \
  --start-time 2023-11-20T00:00:00Z \
  --end-time 2023-11-27T23:59:59Z \
  --period 3600 \
  --statistics Maximum,Average

# Result: Peak usage was 45GB, average 28GB</code></pre>

            <h3>New Configuration</h3>

            <pre><code>resource "aws_elasticache_replication_group" "main" {
  replication_group_id       = "prod-redis"
  replication_group_description = "Production Redis cluster"
  engine                     = "redis"
  engine_version             = "7.0"
  node_type                  = "cache.r6g.xlarge"  # Changed from 2xlarge
  num_cache_clusters         = 4  # Reduced from 6
  parameter_group_name       = "default.redis7"
  port                       = 6379
  
  automatic_failover_enabled = true
  multi_az_enabled          = true
  
  # Enable auto-scaling
  auto_minor_version_upgrade = true
}</code></pre>

            <h2>Strategy 5: VPC Endpoints for NAT Gateway Reduction</h2>

            <div class="info-box success">
                <strong>Result:</strong> Reduced NAT Gateway costs from $4.5K to $2.8K (38% savings)
            </div>

            <h3>NAT Gateway Cost Breakdown</h3>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>2023 Cost</th>
                        <th>2024 Cost</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>NAT Gateway Hours (3 AZs)</td>
                        <td>$1,620</td>
                        <td>$1,620</td>
                    </tr>
                    <tr>
                        <td>Data Processing</td>
                        <td>$2,880</td>
                        <td>$1,180</td>
                    </tr>
                </tbody>
            </table>

            <h3>VPC Endpoints We Added</h3>

            <pre><code># S3 VPC Endpoint (Gateway)
resource "aws_vpc_endpoint" "s3" {
  vpc_id       = aws_vpc.main.id
  service_name = "com.amazonaws.us-east-1.s3"
  
  route_table_ids = aws_route_table.private[*].id
}

# DynamoDB VPC Endpoint (Gateway)
resource "aws_vpc_endpoint" "dynamodb" {
  vpc_id       = aws_vpc.main.id
  service_name = "com.amazonaws.us-east-1.dynamodb"
  
  route_table_ids = aws_route_table.private[*].id
}

# ECR VPC Endpoint (Interface)
resource "aws_vpc_endpoint" "ecr_api" {
  vpc_id              = aws_vpc.main.id
  service_name        = "com.amazonaws.us-east-1.ecr.api"
  vpc_endpoint_type   = "Interface"
  subnet_ids          = aws_subnet.private[*].id
  security_group_ids  = [aws_security_group.vpc_endpoints.id]
  private_dns_enabled = true
}

# Saved $1,700 by avoiding NAT Gateway for AWS service traffic</code></pre>

            <h2>Pre-Event Preparation Checklist</h2>

            <div class="timeline">
                <div class="timeline-item">
                    <strong>2 Weeks Before:</strong> Load testing with 3x expected traffic
                </div>
                <div class="timeline-item">
                    <strong>1 Week Before:</strong> Pre-warm CloudFront cache, verify Spot capacity
                </div>
                <div class="timeline-item">
                    <strong>3 Days Before:</strong> Increase service quotas, enable detailed monitoring
                </div>
                <div class="timeline-item">
                    <strong>1 Day Before:</strong> Final runbook review, on-call schedule confirmed
                </div>
            </div>

            <h2>Real-Time Monitoring During Event</h2>

            <div class="info-box">
                <strong>Key Metrics We Watched:</strong>
                <ul class="icon-list">
                    <li>Spot interruption rate (target: < 5%)</li>
                    <li>Aurora ACU utilization (target: 60-80%)</li>
                    <li>CloudFront cache hit rate (target: > 90%)</li>
                    <li>API latency p99 (target: < 500ms)</li>
                    <li>Error rate (target: < 0.1%)</li>
                </ul>
            </div>

            <h2>Lessons Learned</h2>

            <div class="grid-2">
                <div class="info-box success">
                    <h4>What Worked</h4>
                    <ul class="icon-list">
                        <li>Karpenter handled scaling beautifully</li>
                        <li>Aurora Serverless v2 scaled perfectly</li>
                        <li>Spot interruptions were non-issue</li>
                        <li>CloudFront cache hit rate exceeded expectations</li>
                    </ul>
                </div>
                <div class="info-box warning">
                    <h4>What We'd Improve</h4>
                    <ul class="icon-list cross">
                        <li>Pre-warm more CloudFront POPs</li>
                        <li>Add more VPC endpoints earlier</li>
                        <li>Test Aurora scaling limits beforehand</li>
                        <li>Better cost anomaly detection</li>
                    </ul>
                </div>
            </div>

            <h2>Total Savings Breakdown</h2>

            <div class="metric-card">
                <h4>Total Black Friday Savings</h4>
                <div class="metric-value">$66,000</div>
                <p>52% cost reduction while handling 3x traffic</p>
            </div>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Optimization</th>
                        <th>Savings</th>
                        <th>Effort</th>
                        <th>ROI</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Spot Instances + Karpenter</td>
                        <td>$40,000</td>
                        <td>High</td>
                        <td><span class="cost-badge low">Excellent</span></td>
                    </tr>
                    <tr>
                        <td>Aurora Serverless v2</td>
                        <td>$10,000</td>
                        <td>Medium</td>
                        <td><span class="cost-badge low">Excellent</span></td>
                    </tr>
                    <tr>
                        <td>CloudFront Optimization</td>
                        <td>$10,000</td>
                        <td>Low</td>
                        <td><span class="cost-badge low">Excellent</span></td>
                    </tr>
                    <tr>
                        <td>ElastiCache Right-sizing</td>
                        <td>$4,000</td>
                        <td>Low</td>
                        <td><span class="cost-badge medium">Good</span></td>
                    </tr>
                    <tr>
                        <td>VPC Endpoints</td>
                        <td>$1,700</td>
                        <td>Low</td>
                        <td><span class="cost-badge medium">Good</span></td>
                    </tr>
                </tbody>
            </table>

            <h2>Conclusion</h2>
            <p>By combining Spot instances, Aurora Serverless v2, CloudFront optimization, and right-sizing, we reduced Black Friday AWS spend by 52% while handling 3x more traffic. The key was preparation, automation, and aggressive use of cost-optimized services. These optimizations continue to save us $15K/month in normal operations.</p>
        </article>
    </main>

    <footer>
        <p>&copy; 2024 Suheb Ghare. All rights reserved.</p>
    </footer>

    <script src="blog-stats.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', function() {
            blogStats.updateDisplay('black-friday-aws-cost-reduction');
            blogStats.incrementRead('black-friday-aws-cost-reduction');
        });
    </script>
</body>
</html>
